<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Elevation Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #chart-container {
            height: 100vh;
            width: 100vw;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #chart-canvas {
            width: 80%;
            height: 80%;
        }
    </style>
</head>
<body>

<div id="chart-container">
    <canvas id="chart-canvas"></canvas>
</div>

<script>
    const myLineChart = new Chart(document.getElementById('chart-canvas'), {
        type: 'line',
        data: {
            labels: [],  // X-axis labels (we'll use segments for now)
            datasets: [{
                label: 'Elevation (m)',
                data: [],  // Elevation values (Y-axis data)
                fill: false,
                borderColor: '#37a2eb',
                tension: 0.2
            }]
        },
        options: {
            plugins: {
                legend: { display: true },
                title: { display: true, text: 'Elevation Route Profile' }
            },
            maintainAspectRatio: false,
            responsive: true,
            scales: {
                x: {
                    grid: { display: false },
                    title: { display: true, text: 'Route Segments' }
                },
                y: {
                    title: { display: true, text: 'Elevation (m)' }
                }
            },
            elements: {
                point: { radius: 0 }
            }
        }
    });

    // Function to update the chart with new elevation data
    function updateElevationProfile(elevations) {
        // Set the X-axis labels and Y-axis data
        myLineChart.data.labels = elevations.map((_, index) => `Segment ${index + 1}`);
        myLineChart.data.datasets[0].data = elevations;
        myLineChart.update();
    }

    // Listen for messages from the Thunkable app
    window.addEventListener('message', async (event) => {
        const data = JSON.parse(event.data);

        if (data.coordinates) {
            // Process coordinates and get elevation for each
            const elevations = [];

            for (const coord of data.coordinates) {
                const elevation = map.queryTerrainElevation([coord[0], coord[1]]);
                elevations.push(elevation || 0);  // Push 0 if no elevation data found
            }

            // Update the chart with the retrieved elevation data
            updateElevationProfile(elevations);
        }
    });
</script>

</body>
</html>
