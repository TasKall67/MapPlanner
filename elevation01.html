<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Elevation Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #chart-container {
            height: 100vh;
            width: 100vw;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #chart-canvas {
            width: 80%;
            height: 80%;
        }
    </style>
</head>
<body>

<div id="chart-container">
    <canvas id="chart-canvas"></canvas>
</div>

<script>
    // Define start and end coordinates for the line
    const startCoordinates = [23.80599, 38.048894]; // Start point
    const endCoordinates = [23.817323, 38.033029];  // End point

    // Create GeoJSON LineString
    const lineData = {
        type: 'Feature',
        geometry: {
            type: 'LineString',
            coordinates: [startCoordinates, endCoordinates]
        }
    };

    const myLineChart = new Chart(document.getElementById('chart-canvas'), {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Route Elevation (m)',
                data: [],
                fill: false,
                borderColor: '#37a2eb',
                tension: 0.4
            }]
        },
        options: {
            plugins: {
                legend: { display: true },
                title: { display: true, text: 'Elevation Profile' }
            },
            maintainAspectRatio: false,
            responsive: true,
            scales: {
                x: {
                    grid: { display: false },
                    title: { display: true, text: 'Segments' }
                },
                y: {
                    title: { display: true, text: 'Elevation (m)' }
                }
            },
            elements: {
                point: { radius: 0 }
            }
        }
    });

    async function updateElevationProfile() {
        // Split the line into 1 km segments
        const chunks = turf.lineChunk(lineData, 1).features;

        // Get the elevation for the leading coordinate of each segment
        const elevations = await Promise.all(chunks.map((feature) => {
            return fetch(`https://api.mapbox.com/elevation/v1/mapbox/line?access_token=YOUR_ACCESS_TOKEN&points=${feature.geometry.coordinates[0][1]},${feature.geometry.coordinates[0][0]}`)
                .then(response => response.json())
                .then(data => data.elevations[0].elevation);
        }));

        // Add the last coordinate elevation
        const lastElevation = await fetch(`https://api.mapbox.com/elevation/v1/mapbox/line?access_token=YOUR_ACCESS_TOKEN&points=${chunks[chunks.length - 1].geometry.coordinates[1][1]},${chunks[chunks.length - 1].geometry.coordinates[1][0]}`)
            .then(response => response.json())
            .then(data => data.elevations[0].elevation);
        elevations.push(lastElevation);

        // Update chart with elevation data
        myLineChart.data.labels = Array.from({ length: elevations.length }, (_, i) => `Segment ${i + 1}`);
        myLineChart.data.datasets[0].data = elevations;
        myLineChart.update();
    }

    // Trigger the first chart draw
    updateElevationProfile();
</script>

</body>
</html>
